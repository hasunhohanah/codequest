<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeQuest â€“ Apprenez Ã  Coder</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!--  ğŸ”¥ FIREBASE CONFIG â€” REMPLACEZ CES VALEURS            -->
<!--  (Voir le guide de dÃ©ploiement pour les obtenir)       -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // âš ï¸ REMPLACEZ PAR VOS PROPRES VALEURS FIREBASE âš ï¸
  const firebaseConfig = {
    apiKey: "AIzaSyArQDayT8XWK7zK5o2dR9hBgVDrILy9oEk",
    authDomain: "codequest-d714e.firebaseapp.com",
    projectId: "codequest-d714e",
    storageBucket: "codequest-d714e.firebasestorage.app",
    messagingSenderId: "1088669691000",
    appId: "1:1088669691000:web:71cf2755509f329711518d"
  };

  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  // â”€â”€ Expose vers le scope global (utilisÃ© par les fonctions ci-dessous) â”€â”€
  window._fb = { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, doc, setDoc, getDoc, updateDoc, serverTimestamp };

  // â”€â”€ Surveille l'Ã©tat de connexion â”€â”€
  onAuthStateChanged(auth, async (fbUser) => {
    if (fbUser) {
      const snap = await getDoc(doc(db, "users", fbUser.uid));
      if (snap.exists()) {
        window._currentUser = { uid: fbUser.uid, ...snap.data() };
        enterApp(window._currentUser);
      }
    } else {
      showScreen('auth');
    }
  });
</script>

<style>
:root{
  --bg:#0b0d15;--surface:#13151f;--surface2:#1a1d2e;--surface3:#22263a;
  --border:#2d3152;--text:#eef0ff;--muted:#5c6285;
  --accent:#5eead4;--accent2:#818cf8;--accent3:#fb7185;--accent4:#fbbf24;--accent5:#34d399;
  --radius:18px;--radius-sm:12px;--radius-xs:8px;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);overflow:hidden;}

/* â”€â”€â”€ SCREENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.screen{display:none;width:100%;height:100vh;}
.screen.active{display:flex;}

/* â”€â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#screen-loading{align-items:center;justify-content:center;flex-direction:column;gap:1rem;}
.loading-logo{font-family:'Fredoka One',cursive;font-size:3rem;color:var(--accent);animation:pulse 1.5s ease infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.4;}}
.loading-sub{color:var(--muted);font-size:0.9rem;font-weight:700;}
.loading-dots{display:flex;gap:6px;}
.loading-dots span{width:8px;height:8px;border-radius:50%;background:var(--accent2);animation:dot 1.2s ease infinite;}
.loading-dots span:nth-child(2){animation-delay:.2s;}
.loading-dots span:nth-child(3){animation-delay:.4s;}
@keyframes dot{0%,100%{transform:scale(1);opacity:0.4;}50%{transform:scale(1.4);opacity:1;}}

/* â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#screen-auth{
  background:radial-gradient(ellipse at 20% 50%,#1a1d4e 0%,transparent 60%),
             radial-gradient(ellipse at 80% 20%,#0e2a1e 0%,transparent 50%),var(--bg);
  align-items:center;justify-content:center;flex-direction:column;gap:2rem;
  position:relative;overflow:hidden;
}
.auth-particles{position:absolute;inset:0;pointer-events:none;}
.particle{position:absolute;border-radius:50%;animation:floatUp linear infinite;}
@keyframes floatUp{from{transform:translateY(100vh);}to{transform:translateY(-100px);}}

.auth-logo-wrap{text-align:center;z-index:1;}
.auth-logo{font-family:'Fredoka One',cursive;font-size:3.5rem;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.auth-tagline{color:var(--muted);font-size:0.95rem;margin-top:0.3rem;font-weight:600;}

.auth-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:2rem;width:100%;max-width:420px;box-shadow:0 25px 60px #00000060;z-index:1;}
.auth-tabs{display:flex;gap:0.5rem;margin-bottom:1.5rem;background:var(--surface2);border-radius:var(--radius-sm);padding:4px;}
.auth-tab{flex:1;padding:0.6rem;border:none;border-radius:var(--radius-xs);background:transparent;color:var(--muted);font-family:'Nunito',sans-serif;font-weight:800;font-size:0.9rem;cursor:pointer;transition:all 0.2s;}
.auth-tab.active{background:var(--surface3);color:var(--text);}

.field{margin-bottom:1rem;}
.field label{display:block;font-size:0.75rem;font-weight:800;text-transform:uppercase;letter-spacing:0.06em;color:var(--muted);margin-bottom:0.4rem;}
.field input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-xs);padding:0.75rem 1rem;color:var(--text);font-family:'Nunito',sans-serif;font-size:0.95rem;font-weight:600;transition:border-color 0.2s;}
.field input:focus{outline:none;border-color:var(--accent2);}
.field input::placeholder{color:var(--muted);}

.avatar-row{display:grid;grid-template-columns:repeat(6,1fr);gap:0.5rem;margin-bottom:1rem;}
.ava-opt{height:44px;border-radius:50%;background:var(--surface2);border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:1.3rem;cursor:pointer;transition:all 0.2s;}
.ava-opt:hover{border-color:var(--accent2);}
.ava-opt.sel{border-color:var(--accent);background:var(--surface3);}

.auth-btn{width:100%;padding:0.9rem;border:none;border-radius:var(--radius-sm);background:linear-gradient(135deg,var(--accent2),#6366f1);color:white;font-family:'Nunito',sans-serif;font-size:1rem;font-weight:800;cursor:pointer;transition:all 0.2s;margin-top:0.5rem;}
.auth-btn:hover{opacity:0.88;transform:translateY(-2px);}
.auth-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none;}

.auth-msg{border-radius:var(--radius-xs);padding:0.7rem 1rem;font-size:0.85rem;font-weight:700;margin-bottom:1rem;display:none;}
.auth-msg.show{display:block;}
.auth-msg.error{background:#fb718520;border:1px solid #fb718540;color:var(--accent3);}
.auth-msg.success{background:#5eead420;border:1px solid #5eead440;color:var(--accent);}

.firebase-note{margin-top:1rem;padding:0.8rem;background:var(--surface2);border-radius:var(--radius-xs);font-size:0.75rem;color:var(--muted);text-align:center;border:1px dashed var(--border);}
.firebase-note strong{color:var(--accent4);}

/* â”€â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#screen-app{flex-direction:row;}

.sidebar{width:82px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;padding:1.2rem 0;gap:0.3rem;flex-shrink:0;}
.sidebar-logo{font-family:'Fredoka One',cursive;font-size:1.6rem;color:var(--accent);margin-bottom:1rem;text-shadow:0 0 20px var(--accent)44;}
.nav-btn{width:56px;height:56px;border-radius:14px;border:2px solid transparent;background:transparent;color:var(--muted);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;transition:all 0.2s;}
.nav-btn:hover{background:var(--surface2);color:var(--text);}
.nav-btn.active{background:var(--surface2);color:var(--accent);border-color:var(--accent)33;}
.nav-btn .ni{font-size:1.3rem;}.nav-btn .nl{font-size:0.58rem;font-weight:800;text-transform:uppercase;letter-spacing:0.04em;}
.sidebar-sep{width:40px;height:1px;background:var(--border);margin:0.4rem 0;}
.sidebar-bottom{margin-top:auto;display:flex;flex-direction:column;align-items:center;gap:0.5rem;}
.ava-btn{width:46px;height:46px;border-radius:50%;background:var(--surface2);border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:1.4rem;cursor:pointer;transition:all 0.2s;}
.ava-btn:hover{border-color:var(--accent);}
.logout-btn{width:36px;height:36px;border-radius:10px;border:none;background:transparent;color:var(--muted);font-size:1rem;cursor:pointer;transition:all 0.2s;font-family:'Nunito',sans-serif;}
.logout-btn:hover{background:#fb718522;color:var(--accent3);}

.main{flex:1;display:flex;flex-direction:column;overflow:hidden;}

.topbar{display:flex;align-items:center;gap:1rem;padding:0.9rem 1.5rem;background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0;}
.topbar-title{font-family:'Fredoka One',cursive;font-size:1.2rem;color:var(--accent);flex:1;}
.stat-chip{display:flex;align-items:center;gap:0.5rem;background:var(--surface2);border:1px solid var(--border);border-radius:999px;padding:0.35rem 0.9rem;font-size:0.82rem;font-weight:800;white-space:nowrap;}
.stat-chip.xp{color:var(--accent4);}.stat-chip.str{color:#fb923c;}
.xp-wrap{display:flex;flex-direction:column;gap:2px;min-width:120px;}
.xp-lbl{font-size:0.68rem;font-weight:800;color:var(--muted);}
.xp-track{background:var(--surface2);border-radius:999px;height:7px;}
.xp-fill{background:linear-gradient(90deg,var(--accent),var(--accent2));height:100%;border-radius:999px;transition:width 0.6s cubic-bezier(.34,1.56,.64,1);}
.cloud-badge{background:#5eead422;border:1px solid #5eead444;color:var(--accent);border-radius:999px;padding:0.3rem 0.8rem;font-size:0.72rem;font-weight:800;display:flex;align-items:center;gap:0.4rem;}

.content{flex:1;overflow-y:auto;padding:1.8rem;}
.content::-webkit-scrollbar{width:5px;}
.content::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}

/* â”€â”€â”€ VIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.view{display:none;}
.view.active{display:block;animation:fadeUp 0.3s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* HOME */
.hero{margin-bottom:1.8rem;}
.hero h1{font-family:'Fredoka One',cursive;font-size:2rem;line-height:1.2;}
.hero h1 em{font-style:normal;background:linear-gradient(90deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hero p{color:var(--muted);margin-top:0.3rem;font-size:0.9rem;}

.daily-banner{background:linear-gradient(135deg,#1a1d4e,#1e2a1e);border:1px solid var(--border);border-radius:var(--radius);padding:1.3rem 1.5rem;display:flex;align-items:center;gap:1.2rem;margin-bottom:1.8rem;cursor:pointer;transition:all 0.2s;position:relative;overflow:hidden;}
.daily-banner::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,#ffffff05,transparent);animation:shimmer 3s infinite;}
@keyframes shimmer{from{transform:translateX(-100%);}to{transform:translateX(100%);}}
.daily-banner:hover{border-color:var(--accent2);transform:translateY(-2px);}
.db-icon{font-size:2.8rem;flex-shrink:0;}
.db-text h3{font-weight:800;font-size:1.05rem;margin-bottom:0.2rem;}
.db-text p{font-size:0.82rem;color:var(--muted);}
.db-cta{margin-left:auto;background:var(--accent4);color:#000;border:none;border-radius:999px;padding:0.6rem 1.4rem;font-family:'Nunito',sans-serif;font-weight:800;font-size:0.85rem;cursor:pointer;flex-shrink:0;}

.sec-head{font-size:0.72rem;font-weight:800;text-transform:uppercase;letter-spacing:0.08em;color:var(--muted);margin-bottom:1rem;}
.courses-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(195px,1fr));gap:1rem;margin-bottom:2rem;}
.course-card{background:var(--surface);border:2px solid var(--border);border-radius:var(--radius);padding:1.3rem;cursor:pointer;transition:all 0.25s;position:relative;overflow:hidden;}
.course-card::before{content:'';position:absolute;inset:0;background:var(--cc);opacity:0;transition:opacity 0.25s;}
.course-card:hover{border-color:var(--cc);transform:translateY(-3px);box-shadow:0 8px 24px #00000040;}
.course-card:hover::before{opacity:0.06;}
.cc-badge{position:absolute;top:0.9rem;right:0.9rem;background:var(--cc);color:#000;font-size:0.62rem;font-weight:800;padding:0.15rem 0.5rem;border-radius:999px;}
.cc-icon{font-size:2rem;margin-bottom:0.7rem;}
.cc-name{font-weight:800;font-size:0.95rem;margin-bottom:0.25rem;}
.cc-desc{font-size:0.75rem;color:var(--muted);line-height:1.5;margin-bottom:0.9rem;}
.cc-prog{background:var(--surface2);border-radius:999px;height:5px;}
.cc-prog-fill{height:100%;border-radius:999px;background:var(--cc);}
.cc-meta{display:flex;justify-content:space-between;margin-top:0.5rem;font-size:0.7rem;color:var(--muted);font-weight:700;}

/* LESSON */
.lesson-bar{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;}
.back-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:0.5rem 1rem;border-radius:var(--radius-xs);font-size:0.82rem;font-weight:700;cursor:pointer;font-family:'Nunito',sans-serif;transition:all 0.2s;}
.back-btn:hover{border-color:var(--accent);color:var(--accent);}
.lesson-info h2{font-size:1.3rem;font-weight:900;}
.lesson-info p{color:var(--muted);font-size:0.82rem;}

.units-list{display:flex;flex-direction:column;gap:0.8rem;}
.unit-row{background:var(--surface);border:2px solid var(--border);border-radius:var(--radius);padding:1.1rem 1.3rem;display:flex;align-items:center;gap:1rem;cursor:pointer;transition:all 0.2s;}
.unit-row:hover:not(.locked){border-color:var(--uc);transform:translateX(5px);}
.unit-row.done{border-color:var(--accent)55;background:#5eead408;}
.unit-row.locked{opacity:0.38;cursor:not-allowed;}
.unit-ico{width:46px;height:46px;border-radius:12px;background:var(--surface2);display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;border:2px solid var(--uc,#5eead4)33;}
.unit-row.done .unit-ico{border-color:var(--accent);background:#5eead411;}
.unit-txt{flex:1;}
.unit-txt h3{font-weight:800;font-size:0.9rem;margin-bottom:0.15rem;}
.unit-txt p{font-size:0.75rem;color:var(--muted);}
.unit-xp{background:var(--surface2);border:1px solid var(--border);border-radius:999px;padding:0.2rem 0.7rem;font-size:0.72rem;font-weight:800;color:var(--accent4);white-space:nowrap;}

/* QUIZ */
.quiz-top{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;}
.q-prog-wrap{flex:1;}
.q-prog-track{background:var(--surface2);border-radius:999px;height:10px;border:1px solid var(--border);}
.q-prog-fill{background:linear-gradient(90deg,var(--accent),var(--accent2));height:100%;border-radius:999px;transition:width 0.5s ease;}
.q-counter{font-size:0.8rem;font-weight:800;color:var(--muted);white-space:nowrap;}
.infinite-badge{background:#5eead422;border:1px solid #5eead444;color:var(--accent);border-radius:999px;padding:0.3rem 0.8rem;font-size:0.75rem;font-weight:800;}

.quiz-card{max-width:700px;margin:0 auto;background:var(--surface);border:2px solid var(--border);border-radius:var(--radius);padding:2rem;}
.q-pill{display:inline-flex;align-items:center;gap:0.4rem;background:var(--surface2);border:1px solid var(--border);border-radius:999px;padding:0.25rem 0.8rem;font-size:0.7rem;font-weight:800;color:var(--muted);text-transform:uppercase;letter-spacing:0.06em;margin-bottom:1.1rem;}
.q-text{font-size:1.1rem;font-weight:800;line-height:1.5;margin-bottom:0.8rem;}
.code-block{background:#080a12;border:1px solid var(--border);border-left:3px solid var(--accent2);border-radius:var(--radius-xs);padding:1rem 1.2rem;font-family:'JetBrains Mono',monospace;font-size:0.82rem;line-height:1.8;margin-bottom:1.5rem;overflow-x:auto;color:#c9d1d9;}
.kw{color:#c084fc;}.fn{color:#7dd3fc;}.str{color:#86efac;}.cm{color:#374151;font-style:italic;}.num{color:#fb923c;}.op{color:#f472b6;}.cls{color:#fde68a;}.mc{color:#6ade80;}.wc{color:#c79a3e;}

.opts-grid{display:grid;grid-template-columns:1fr 1fr;gap:0.8rem;margin-bottom:1.3rem;}
.opt-btn{background:var(--surface2);border:2px solid var(--border);border-radius:var(--radius-sm);padding:0.9rem 1rem;color:var(--text);font-family:'Nunito',sans-serif;font-size:0.88rem;font-weight:700;cursor:pointer;transition:all 0.2s;text-align:left;display:flex;align-items:center;gap:0.7rem;}
.opt-btn:hover:not(:disabled){border-color:var(--accent2);background:#818cf811;}
.opt-btn.sel{border-color:var(--accent2);background:#818cf818;}
.opt-btn.ok{border-color:var(--accent)!important;background:#5eead418!important;color:var(--accent);}
.opt-btn.bad{border-color:var(--accent3)!important;background:#fb718518!important;color:var(--accent3);}
.opt-key{width:28px;height:28px;background:var(--surface);border:1px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.72rem;font-weight:800;color:var(--muted);flex-shrink:0;}
.opt-btn.ok .opt-key{background:var(--accent);color:#000;border-color:var(--accent);}
.opt-btn.bad .opt-key{background:var(--accent3);color:#fff;border-color:var(--accent3);}

.fill-wrap{margin-bottom:1.3rem;}
.fill-inp{background:var(--surface2);border:2px solid var(--accent2);border-radius:6px;color:var(--accent2);font-family:'JetBrains Mono',monospace;font-size:0.95rem;font-weight:700;padding:0.5rem 1rem;width:180px;text-align:center;outline:none;transition:all 0.2s;}
.fill-inp:focus{border-color:var(--accent);box-shadow:0 0 0 3px #5eead420;}
.fill-inp.ok{border-color:var(--accent);color:var(--accent);}
.fill-inp.bad{border-color:var(--accent3);color:var(--accent3);}

.feedback{border-radius:var(--radius-sm);padding:1rem 1.2rem;margin-bottom:1.2rem;display:none;gap:0.8rem;align-items:flex-start;}
.feedback.show{display:flex;}
.feedback.ok{background:#5eead415;border:1px solid #5eead433;color:var(--accent);}
.feedback.bad{background:#fb718515;border:1px solid #fb718533;color:var(--accent3);}
.fb-ico{font-size:1.3rem;flex-shrink:0;}
.fb-body strong{display:block;margin-bottom:0.2rem;font-size:0.9rem;}
.fb-body span{font-size:0.8rem;opacity:0.8;}

.quiz-actions{display:flex;gap:0.8rem;}
.q-btn{flex:1;padding:0.85rem;border:none;border-radius:var(--radius-sm);font-family:'Nunito',sans-serif;font-size:0.95rem;font-weight:800;cursor:pointer;transition:all 0.2s;}
.q-btn.primary{background:linear-gradient(135deg,var(--accent2),#6366f1);color:white;}
.q-btn.success{background:linear-gradient(135deg,var(--accent),var(--accent5));color:#000;}
.q-btn.skip{background:var(--surface2);color:var(--muted);border:1px solid var(--border);flex:0 0 auto;padding:0.85rem 1.2rem;}
.q-btn:hover:not(:disabled){opacity:0.85;transform:translateY(-2px);}
.q-btn:disabled{opacity:0.3;cursor:default;transform:none;}

/* RESULTS */
.results-wrap{max-width:520px;margin:2rem auto;text-align:center;}
.res-trophy{font-size:5rem;display:block;animation:pop 0.5s cubic-bezier(.34,1.56,.64,1);margin-bottom:1rem;}
@keyframes pop{from{transform:scale(0);}to{transform:scale(1);}}
.res-title{font-family:'Fredoka One',cursive;font-size:2rem;margin-bottom:0.5rem;}
.res-sub{color:var(--muted);margin-bottom:1.8rem;font-size:0.9rem;}
.res-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;margin-bottom:1.8rem;}
.res-stat{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:1.2rem;}
.rv{font-size:1.8rem;font-weight:900;}.rl{font-size:0.68rem;color:var(--muted);font-weight:800;text-transform:uppercase;margin-top:0.2rem;}
.res-btns{display:flex;flex-direction:column;gap:0.8rem;}
.res-btn{padding:0.85rem;border:none;border-radius:var(--radius-sm);font-family:'Nunito',sans-serif;font-weight:800;font-size:0.95rem;cursor:pointer;transition:all 0.2s;}
.res-btn.main{background:linear-gradient(135deg,var(--accent2),#6366f1);color:white;}
.res-btn.sec{background:var(--surface2);color:var(--text);border:1px solid var(--border);}
.res-btn:hover{opacity:0.85;transform:translateY(-1px);}

/* LEADERBOARD */
.lb-head{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;}
.lb-head h1{font-family:'Fredoka One',cursive;font-size:1.8rem;}
.lb-badge{font-size:0.78rem;color:var(--muted);font-weight:700;background:var(--surface2);border:1px solid var(--border);border-radius:999px;padding:0.3rem 0.8rem;}
.lb-list{display:flex;flex-direction:column;gap:0.6rem;}
.lb-row{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:1rem 1.2rem;display:flex;align-items:center;gap:0.9rem;transition:all 0.2s;}
.lb-row:hover{transform:translateX(4px);}
.lb-row.me{border-color:var(--accent);background:#5eead408;}
.lb-rank{font-size:1.1rem;font-weight:900;width:30px;text-align:center;flex-shrink:0;}
.lb-ava{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.lb-info{flex:1;}
.lb-name{font-weight:800;font-size:0.9rem;}
.lb-sub{font-size:0.72rem;color:var(--muted);margin-top:1px;}
.lb-xp{font-weight:900;color:var(--accent4);font-size:0.88rem;}

/* PROFILE */
.prof-top{background:linear-gradient(135deg,var(--surface2),var(--surface));border:1px solid var(--border);border-radius:var(--radius);padding:1.8rem;margin-bottom:1.3rem;display:flex;align-items:center;gap:1.5rem;}
.prof-ava{width:88px;height:88px;border-radius:50%;background:var(--surface3);display:flex;align-items:center;justify-content:center;font-size:2.5rem;border:3px solid var(--accent);box-shadow:0 0 20px var(--accent)44;flex-shrink:0;}
.prof-inf h2{font-size:1.4rem;font-weight:900;}
.prof-email{font-size:0.8rem;color:var(--muted);margin-top:0.2rem;}
.prof-cloud{display:inline-flex;align-items:center;gap:0.4rem;margin-top:0.5rem;background:#5eead422;border:1px solid #5eead444;color:var(--accent);border-radius:999px;padding:0.25rem 0.7rem;font-size:0.72rem;font-weight:800;}
.pstats{display:grid;grid-template-columns:repeat(4,1fr);gap:0.8rem;margin-bottom:1.3rem;}
.pstat{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);padding:1rem;text-align:center;}
.pv{font-size:1.5rem;font-weight:900;}.pl{font-size:0.67rem;color:var(--muted);font-weight:800;text-transform:uppercase;margin-top:0.2rem;}
.ach-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:0.8rem;}
.ach-card{background:var(--surface);border:2px solid var(--border);border-radius:var(--radius-sm);padding:1rem;text-align:center;transition:all 0.2s;}
.ach-card.unlocked{border-color:var(--accent4);background:#fbbf2408;}
.ach-card:hover{transform:translateY(-2px);}
.ach-ico{font-size:1.8rem;margin-bottom:0.4rem;}
.ach-nm{font-size:0.75rem;font-weight:800;margin-bottom:0.15rem;}
.ach-ds{font-size:0.67rem;color:var(--muted);}

/* TOAST */
.toast{position:fixed;bottom:1.5rem;right:1.5rem;z-index:9999;padding:0.8rem 1.4rem;border-radius:999px;font-weight:800;font-size:0.9rem;transform:translateY(80px);opacity:0;pointer-events:none;transition:all 0.4s cubic-bezier(.34,1.56,.64,1);}
.toast.show{transform:translateY(0);opacity:1;}
.toast.xp{background:var(--accent4);color:#000;}
.toast.info{background:var(--accent2);color:white;}
.toast.err{background:var(--accent3);color:white;}
.toast.cloud{background:var(--accent);color:#000;}
</style>
</head>
<body>

<!-- LOADING -->
<div class="screen active" id="screen-loading">
  <div class="loading-logo">âš¡ CodeQuest</div>
  <div class="loading-sub">Connexion Ã  Firebaseâ€¦</div>
  <div class="loading-dots"><span></span><span></span><span></span></div>
</div>

<!-- AUTH -->
<div class="screen" id="screen-auth">
  <div class="auth-particles" id="auth-particles"></div>
  <div class="auth-logo-wrap">
    <div class="auth-logo">âš¡ CodeQuest</div>
    <div class="auth-tagline">Apprenez Ã  coder Â· Progression sauvegardÃ©e dans le cloud â˜ï¸</div>
  </div>
  <div class="auth-card">
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Connexion</button>
      <button class="auth-tab" onclick="switchTab('register')">CrÃ©er un compte</button>
    </div>
    <div class="auth-msg" id="auth-msg"></div>

    <!-- LOGIN -->
    <div id="tab-login">
      <div class="field"><label>Adresse e-mail</label><input id="l-email" type="email" placeholder="vous@exemple.com"></div>
      <div class="field"><label>Mot de passe</label><input id="l-pwd" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <button class="auth-btn" id="login-btn" onclick="doLogin()">Se connecter â†’</button>
    </div>

    <!-- REGISTER -->
    <div id="tab-register" style="display:none">
      <div class="field"><label>Pseudo</label><input id="r-name" type="text" placeholder="CoolCoder42"></div>
      <div class="field"><label>Adresse e-mail</label><input id="r-email" type="email" placeholder="vous@exemple.com"></div>
      <div class="field"><label>Mot de passe (min. 6 caractÃ¨res)</label><input id="r-pwd" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <div class="field"><label>Avatar</label><div class="avatar-row" id="ava-grid"></div></div>
      <button class="auth-btn" id="register-btn" onclick="doRegister()">CrÃ©er mon compte ğŸš€</button>
    </div>

    <div class="firebase-note">
      â˜ï¸ Vos donnÃ©es sont sauvegardÃ©es sur <strong>Firebase</strong> â€” accessibles depuis n'importe quel appareil
    </div>
  </div>
</div>

<!-- APP -->
<div class="screen" id="screen-app">
  <div class="sidebar">
    <div class="sidebar-logo">âš¡</div>
    <button class="nav-btn active" id="nb-home" onclick="showView('home')"><span class="ni">ğŸ </span><span class="nl">Accueil</span></button>
    <button class="nav-btn" id="nb-leaderboard" onclick="showView('leaderboard')"><span class="ni">ğŸ†</span><span class="nl">Top</span></button>
    <button class="nav-btn" id="nb-profile" onclick="showView('profile')"><span class="ni">ğŸ‘¤</span><span class="nl">Profil</span></button>
    <div class="sidebar-sep"></div>
    <div class="sidebar-bottom">
      <div class="ava-btn" id="sb-ava" onclick="showView('profile')">ğŸ§‘</div>
      <button class="logout-btn" title="DÃ©connexion" onclick="doLogout()">â»</button>
    </div>
  </div>

  <div class="main">
    <div class="topbar">
      <div class="topbar-title">CodeQuest</div>
      <div class="cloud-badge">â˜ï¸ Sauvegarde cloud active</div>
      <div class="xp-wrap">
        <div class="xp-lbl">Niveau <span id="tb-lvl">1</span></div>
        <div class="xp-track"><div class="xp-fill" id="tb-xp-fill" style="width:0%"></div></div>
      </div>
      <div class="stat-chip xp">âš¡ <span id="tb-xp">0</span> XP</div>
      <div class="stat-chip str">ğŸ”¥ <span id="tb-str">0</span> jours</div>
    </div>

    <div class="content">

      <!-- HOME -->
      <div class="view active" id="view-home">
        <div class="hero">
          <h1>PrÃªt Ã  coder,<br><em id="hero-name">Coder</em> ?</h1>
          <p>â™¾ï¸ Aucune vie limitÃ©e Â· â˜ï¸ Progression sauvegardÃ©e dans le cloud</p>
        </div>
        <div class="daily-banner" onclick="startLesson('daily')">
          <div class="db-icon">âš¡</div>
          <div class="db-text"><h3>DÃ©fi du Jour</h3><p>Mix de langages Â· 5 questions Â· Double XP</p></div>
          <button class="db-cta">Lancer â†’</button>
        </div>
        <div class="sec-head">Tous les Parcours</div>
        <div class="courses-grid" id="courses-grid"></div>
      </div>

      <!-- LESSON -->
      <div class="view" id="view-lesson">
        <div class="lesson-bar">
          <button class="back-btn" onclick="showView('home')">â† Retour</button>
          <div class="lesson-info"><h2 id="lesson-title">Cours</h2><p id="lesson-sub"></p></div>
        </div>
        <div class="units-list" id="units-list"></div>
      </div>

      <!-- QUIZ -->
      <div class="view" id="view-quiz">
        <div class="quiz-top">
          <button class="back-btn" onclick="exitQuiz()">âœ•</button>
          <div class="q-prog-wrap"><div class="q-prog-track"><div class="q-prog-fill" id="q-prog" style="width:0%"></div></div></div>
          <div class="q-counter" id="q-counter">1/5</div>
          <div class="infinite-badge">â™¾ï¸ Sans limite</div>
        </div>
        <div class="quiz-card">
          <div class="q-pill" id="q-pill">QCM</div>
          <div class="q-text" id="q-text"></div>
          <div class="code-block" id="q-code" style="display:none"></div>
          <div id="q-opts"></div>
          <div class="feedback" id="q-feedback">
            <span class="fb-ico" id="fb-ico"></span>
            <div class="fb-body"><strong id="fb-title"></strong><span id="fb-detail"></span></div>
          </div>
          <div class="quiz-actions">
            <button class="q-btn skip" id="skip-btn" onclick="skipQ()">Passer</button>
            <button class="q-btn primary" id="submit-btn" onclick="handleSubmit()" disabled>VÃ©rifier</button>
          </div>
        </div>
      </div>

      <!-- RESULTS -->
      <div class="view" id="view-results">
        <div class="results-wrap">
          <span class="res-trophy" id="res-trophy">ğŸ‰</span>
          <div class="res-title" id="res-title">LeÃ§on terminÃ©e !</div>
          <div class="res-sub" id="res-sub"></div>
          <div class="res-stats">
            <div class="res-stat"><div class="rv" id="rv-xp" style="color:var(--accent4)">+0</div><div class="rl">XP GagnÃ©s</div></div>
            <div class="res-stat"><div class="rv" id="rv-acc" style="color:var(--accent)">0%</div><div class="rl">PrÃ©cision</div></div>
            <div class="res-stat"><div class="rv" id="rv-time" style="color:var(--accent2)">0:00</div><div class="rl">Temps</div></div>
          </div>
          <div class="res-btns">
            <button class="res-btn main" onclick="showView('home')">ğŸ  Accueil</button>
            <button class="res-btn sec" onclick="replayLesson()">ğŸ” Rejouer</button>
          </div>
        </div>
      </div>

      <!-- LEADERBOARD -->
      <div class="view" id="view-leaderboard">
        <div class="lb-head"><h1>ğŸ† Classement</h1><span class="lb-badge">Cette semaine</span></div>
        <div class="lb-list" id="lb-list"></div>
      </div>

      <!-- PROFILE -->
      <div class="view" id="view-profile">
        <div class="prof-top">
          <div class="prof-ava" id="prof-ava">ğŸ§‘</div>
          <div class="prof-inf">
            <h2 id="prof-name">â€”</h2>
            <div class="prof-email" id="prof-email">â€”</div>
            <div class="prof-cloud">â˜ï¸ DonnÃ©es sauvegardÃ©es sur Firebase</div>
          </div>
        </div>
        <div class="pstats">
          <div class="pstat"><div class="pv" id="ps-xp" style="color:var(--accent4)">0</div><div class="pl">Total XP</div></div>
          <div class="pstat"><div class="pv" id="ps-str" style="color:#fb923c">ğŸ”¥0</div><div class="pl">SÃ©rie</div></div>
          <div class="pstat"><div class="pv" id="ps-les" style="color:var(--accent)">0</div><div class="pl">LeÃ§ons</div></div>
          <div class="pstat"><div class="pv" id="ps-acc" style="color:var(--accent2)">0%</div><div class="pl">PrÃ©cision</div></div>
        </div>
        <div class="sec-head" style="margin-bottom:1rem">SuccÃ¨s</div>
        <div class="ach-grid" id="ach-grid"></div>
      </div>

    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AVATARS & COURSES DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const AVATARS = ['ğŸ§‘','ğŸ‘¨â€ğŸ’»','ğŸ‘©â€ğŸ’»','ğŸ§‘â€ğŸ’»','ğŸ¦Š','ğŸ‰','ğŸ¤–','ğŸ®','âš¡','ğŸŒŸ','ğŸ§™','ğŸ‘¾'];
let selAva = AVATARS[0];

const COURSES = [
  {id:'python',    name:'Python',         icon:'ğŸ', color:'#5eead4', desc:'Variables, boucles, POO, fichiers', badge:'Populaire',
    units:[
      {id:'py-var',  icon:'ğŸ“¦', name:'Variables & Types',       desc:'int, str, float, bool', xp:10},
      {id:'py-cond', icon:'ğŸ”€', name:'Conditions if/else',      desc:'if, elif, else', xp:10},
      {id:'py-loop', icon:'ğŸ”', name:'Boucles for & while',     desc:'range(), break, continue', xp:15},
      {id:'py-func', icon:'âš™ï¸', name:'Fonctions',               desc:'def, return, *args, **kwargs', xp:15, locked:true},
      {id:'py-list', icon:'ğŸ“‹', name:'Listes & Tuples',         desc:'Indexing, slicing, mÃ©thodes', xp:20, locked:true},
      {id:'py-dict', icon:'ğŸ“–', name:'Dictionnaires',           desc:'ClÃ©s, valeurs, parcours', xp:20, locked:true},
      {id:'py-oop',  icon:'ğŸ›ï¸', name:'Classe & POO',           desc:'class, hÃ©ritage, mÃ©thodes', xp:25, locked:true},
    ]},
  {id:'javascript',name:'JavaScript',     icon:'âš¡', color:'#fbbf24', desc:'ES6+, DOM, async, APIs', badge:null,
    units:[
      {id:'js-var',  icon:'ğŸ“¦', name:'let, const & Types',      desc:'DÃ©clarations, typeof', xp:10},
      {id:'js-func', icon:'ğŸ¯', name:'Fonctions & Arrow',       desc:'function, =>, callbacks', xp:15},
      {id:'js-dom',  icon:'ğŸŒ', name:'DOM & Ã‰vÃ©nements',        desc:'querySelector, addEventListener', xp:20, locked:true},
      {id:'js-async',icon:'ğŸ”„', name:'Async / Await',           desc:'Promise, fetch, try/catch', xp:25, locked:true},
    ]},
  {id:'java',      name:'Java',           icon:'â˜•', color:'#e76f51', desc:'Types, POO, Collections, JVM', badge:'Complet',
    units:[
      {id:'jv-base', icon:'ğŸ–¥ï¸', name:'Hello World & Types',    desc:'System.out, int, String', xp:10},
      {id:'jv-class',icon:'ğŸ›ï¸', name:'Classes & Objets',       desc:'class, new, constructeur, this', xp:15},
      {id:'jv-inh',  icon:'ğŸ”—', name:'HÃ©ritage & Polymorphisme',desc:'extends, super, @Override', xp:20, locked:true},
      {id:'jv-coll', icon:'ğŸ“š', name:'Collections & Generics',  desc:'ArrayList, HashMap, for-each', xp:20, locked:true},
      {id:'jv-exc',  icon:'âš ï¸', name:'Exceptions',             desc:'try, catch, finally, throws', xp:15, locked:true},
      {id:'jv-str',  icon:'ğŸ§µ', name:'Threads & Concurrence',  desc:'Thread, Runnable, synchronized', xp:25, locked:true},
    ]},
  {id:'html',      name:'HTML / CSS',     icon:'ğŸŒ', color:'#f472b6', desc:'Structure, styles, Flexbox, Grid', badge:'Facile',
    units:[
      {id:'ht-base', icon:'ğŸ—ï¸', name:'Balises de base',        desc:'html, head, body, sÃ©mantique', xp:10},
      {id:'ht-css',  icon:'ğŸ¨', name:'CSS Fondamentaux',        desc:'SÃ©lecteurs, box model, couleurs', xp:10},
      {id:'ht-flex', icon:'ğŸ“', name:'Flexbox',                 desc:'display:flex, justify, align', xp:15, locked:true},
      {id:'ht-grid', icon:'ğŸ”²', name:'CSS Grid',                desc:'grid-template, areas, gaps', xp:15, locked:true},
      {id:'ht-resp', icon:'ğŸ“±', name:'Responsive Design',       desc:'media queries, mobile-first', xp:20, locked:true},
    ]},
  {id:'cpp',       name:'C++',            icon:'âš™ï¸', color:'#60a5fa', desc:'Pointeurs, STL, mÃ©moire, OOP', badge:'AvancÃ©',
    units:[
      {id:'cp-base', icon:'ğŸ–¥ï¸', name:'Syntaxe de base',         desc:'#include, cout, cin, types', xp:10},
      {id:'cp-ptr',  icon:'ğŸ§ ', name:'Pointeurs & MÃ©moire',     desc:'*, &, new, delete', xp:25, locked:true},
      {id:'cp-oop',  icon:'ğŸ›ï¸', name:'Classes & HÃ©ritage',     desc:'class, virtual, destructor', xp:25, locked:true},
    ]},
  {id:'linux',     name:'Linux / Ubuntu', icon:'ğŸ§', color:'#a78bfa', desc:'Terminal, Bash, rÃ©seau, sÃ©curitÃ©', badge:'Nouveau',
    units:[
      {id:'lx-term', icon:'ğŸ’»', name:'Terminal Basics',         desc:'ls, cd, pwd, mkdir, rm', xp:10},
      {id:'lx-perm', icon:'ğŸ”’', name:'Fichiers & Permissions',  desc:'chmod, chown, cat, nano', xp:15},
      {id:'lx-bash', icon:'âš¡', name:'Bash Scripting',          desc:'Variables, boucles, fonctions', xp:20, locked:true},
      {id:'lx-apt',  icon:'ğŸ“¦', name:'APT & Paquets',           desc:'install, update, upgrade', xp:10, locked:true},
      {id:'lx-net',  icon:'ğŸŒ', name:'RÃ©seau & SSH',            desc:'ip, ssh, scp, curl', xp:20, locked:true},
    ]},
  {id:'minecraft', name:'Minecraft Mods', icon:'â›ï¸', color:'#5eab3c', desc:'Forge, Fabric, items, blocs, datapacks', badge:'Fun !',
    units:[
      {id:'mc-env',  icon:'ğŸ› ï¸', name:'Environnement de Dev',   desc:'JDK, Forge/Fabric, IntelliJ', xp:15},
      {id:'mc-first',icon:'â›ï¸', name:'Premier Mod Forge',      desc:'@Mod, FMLCommonSetup, structure', xp:20},
      {id:'mc-item', icon:'ğŸ’', name:'CrÃ©er des Items',         desc:'Item class, registry, modÃ¨le JSON', xp:20, locked:true},
      {id:'mc-block',icon:'ğŸ§±', name:'CrÃ©er des Blocs',         desc:'Block class, loot tables', xp:20, locked:true},
      {id:'mc-event',icon:'ğŸ®', name:'Ã‰vÃ©nements & Handlers',   desc:'@SubscribeEvent, PlayerEvent', xp:25, locked:true},
      {id:'mc-rp',   icon:'ğŸ¨', name:'Resource Packs',          desc:'Textures PNG, sounds.json', xp:15, locked:true},
      {id:'mc-dp',   icon:'ğŸ“œ', name:'Datapacks',               desc:'.mcfunction, advancements, loot', xp:15, locked:true},
    ]},
  {id:'wow',       name:'WoW Add-ons',    icon:'ğŸ§™', color:'#c79a3e', desc:'Lua, API Blizzard, UI, events', badge:'MMO',
    units:[
      {id:'wo-lua',  icon:'ğŸ“œ', name:'Lua Fondamentaux',        desc:'Variables, tables, fonctions', xp:15},
      {id:'wo-toc',  icon:'ğŸ“‹', name:'Structure d\'un Add-on',  desc:'.toc, metadata, chargement', xp:15},
      {id:'wo-frame',icon:'ğŸ–¼ï¸', name:'Frames & UI',            desc:'CreateFrame, SetPoint, SetSize', xp:20, locked:true},
      {id:'wo-event',icon:'âš¡', name:'Ã‰vÃ©nements WoW',          desc:'RegisterEvent, COMBAT_LOG', xp:20, locked:true},
      {id:'wo-api',  icon:'ğŸ”®', name:'API Blizzard',            desc:'UnitHealth, GetSpellInfo', xp:25, locked:true},
    ]},
  {id:'git',       name:'Git & GitHub',   icon:'ğŸŒ¿', color:'#f9a8d4', desc:'Versioning, branches, CI/CD', badge:null,
    units:[
      {id:'gt-init', icon:'ğŸ“', name:'Init & Commit',           desc:'git init, add, commit, status', xp:10},
      {id:'gt-br',   icon:'ğŸŒ¿', name:'Branches & Merge',        desc:'branch, checkout, merge', xp:15, locked:true},
      {id:'gt-remote',icon:'ğŸŒ',name:'GitHub & Remote',         desc:'push, pull, clone, fork, PR', xp:15, locked:true},
    ]},
  {id:'sql',       name:'SQL',            icon:'ğŸ—„ï¸', color:'#34d399', desc:'SELECT, JOINs, agrÃ©gations', badge:null,
    units:[
      {id:'sq-sel',  icon:'ğŸ“Š', name:'SELECT & WHERE',          desc:'RequÃªtes, filtres, ORDER BY', xp:10},
      {id:'sq-join', icon:'ğŸ”—', name:'JOINs',                   desc:'INNER, LEFT, RIGHT, FULL JOIN', xp:20, locked:true},
    ]},
];

const Q = {
  'py-var':[
    {type:'mcq',pill:'ğŸ“¦ Python Â· Variables',q:'Quel type Python stocke un nombre dÃ©cimal ?',opts:['float','int','str','decimal'],c:0,ex:'float stocke les dÃ©cimaux : 3.14, -0.5â€¦'},
    {type:'mcq',pill:'ğŸ“¦ Python Â· Variables',q:'Comment afficher "Bonjour" en Python ?',opts:['print("Bonjour")','echo "Bonjour"','console.log("Bonjour")','write("Bonjour")'],c:0,ex:'print() est la fonction standard d\'affichage en Python.'},
    {type:'fill',pill:'ğŸ“¦ Python Â· Variables',q:'CrÃ©ez une variable "age" avec la valeur 25 :',code:`<span class="op">___</span> = <span class="num">25</span>`,blank:'age',ex:'En Python : nom_variable = valeur. Simple !'},
    {type:'mcq',pill:'ğŸ“¦ Python Â· Variables',q:'Quel opÃ©rateur concatÃ¨ne deux strings ?',opts:['+','*','&','..'],c:0,ex:'"Hello" + "World" â†’ "HelloWorld"'},
    {type:'mcq',pill:'ğŸ“¦ Python Â· Variables',q:'Comment vÃ©rifier le type d\'une variable x ?',opts:['type(x)','typeof x','x.getType()','x.type'],c:0,ex:'type(42) renvoie <class \'int\'>.'},
  ],
  'py-loop':[
    {type:'mcq',pill:'ğŸ” Boucles',q:'Sortie de ce code ?',code:`<span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(<span class="num">3</span>):\n    <span class="fn">print</span>(i)`,opts:['0 1 2','1 2 3','0 1 2 3','1 2'],c:0,ex:'range(3) gÃ©nÃ¨re 0, 1, 2 â€” pas 3.'},
    {type:'mcq',pill:'ğŸ” Boucles',q:'Quel mot-clÃ© arrÃªte une boucle immÃ©diatement ?',opts:['break','stop','return','exit'],c:0,ex:'break quitte la boucle en cours.'},
    {type:'fill',pill:'ğŸ” Boucles',q:'ComplÃ©tez pour que range() commence Ã  1 :',code:`<span class="kw">for</span> i <span class="kw">in</span> <span class="fn">range</span>(<span class="op">___</span>, <span class="num">6</span>):\n    <span class="fn">print</span>(i)`,blank:'1',ex:'range(1, 6) gÃ©nÃ¨re 1, 2, 3, 4, 5.'},
    {type:'mcq',pill:'ğŸ” Boucles',q:'Que fait continue ?',opts:['Saute l\'itÃ©ration courante','ArrÃªte la boucle','Retourne une valeur','Affiche rien'],c:0,ex:'continue passe Ã  l\'itÃ©ration suivante sans exÃ©cuter le reste du bloc.'},
    {type:'mcq',pill:'ğŸ” Boucles',q:'Quelle boucle s\'exÃ©cute tant qu\'une condition est vraie ?',opts:['while','for','loop','repeat'],c:0,ex:'while condition: ... continue tant que la condition est True.'},
  ],
  'jv-base':[
    {type:'mcq',pill:'â˜• Java Â· Bases',q:'Comment afficher "Hello World" en Java ?',code:`<span class="kw">public class</span> <span class="cls">Main</span> {\n  <span class="kw">public static void</span> <span class="fn">main</span>(String[] args) {\n    ???\n  }\n}`,opts:['System.out.println("Hello World");','print("Hello World");','echo "Hello World";','console.log("Hello World");'],c:0,ex:'System.out.println() est la mÃ©thode d\'affichage standard en Java.'},
    {type:'mcq',pill:'â˜• Java Â· Types',q:'Quel type pour un entier en Java ?',opts:['int','integer','number','whole'],c:0,ex:'int est le type primitif pour les entiers (âˆ’2Â³Â¹ Ã  2Â³Â¹âˆ’1).'},
    {type:'fill',pill:'â˜• Java Â· Bases',q:'DÃ©clarez une variable String "nom" :',code:`<span class="cls">String</span> nom = <span class="op">___</span>;`,blank:'"Alice"',ex:'Les chaÃ®nes Java s\'Ã©crivent entre guillemets doubles.'},
    {type:'mcq',pill:'â˜• Java Â· Types',q:'DiffÃ©rence entre int et Integer ?',opts:['int est primitif, Integer est un objet','C\'est la mÃªme chose','Integer est plus rapide','int est une classe'],c:0,ex:'int = type primitif (valeur directe). Integer = objet wrapper avec mÃ©thodes.'},
    {type:'mcq',pill:'â˜• Java Â· Bases',q:'DÃ©clarer une constante en Java ?',opts:['final int MAX = 100;','const int MAX = 100;','static int MAX = 100;','readonly int MAX = 100;'],c:0,ex:'final empÃªche la rÃ©assignation â€” c\'est une constante.'},
  ],
  'jv-class':[
    {type:'mcq',pill:'ğŸ›ï¸ Java Â· Classes',q:'Quel mot-clÃ© crÃ©e une instance ?',code:`<span class="cls">Voiture</span> v = <span class="op">???</span> <span class="cls">Voiture</span>();`,opts:['new','create','make','instance'],c:0,ex:'new alloue la mÃ©moire et appelle le constructeur.'},
    {type:'mcq',pill:'ğŸ›ï¸ Java Â· Classes',q:'Qu\'est-ce qu\'un constructeur ?',opts:['MÃ©thode appelÃ©e Ã  la crÃ©ation de l\'objet','MÃ©thode statique','Type de variable','Interface'],c:0,ex:'Le constructeur initialise l\'objet. MÃªme nom que la classe, pas de type retour.'},
    {type:'fill',pill:'ğŸ›ï¸ Java Â· Classes',q:'Nom du constructeur de la classe Chien ?',code:`<span class="kw">public class</span> <span class="cls">Chien</span> {\n  <span class="kw">public</span> <span class="op">___</span>(String nom) { }\n}`,blank:'Chien',ex:'Le constructeur porte exactement le mÃªme nom que la classe.'},
    {type:'mcq',pill:'ğŸ›ï¸ Java Â· Classes',q:'Quelle visibilitÃ© interdit l\'accÃ¨s depuis une autre classe ?',opts:['private','public','protected','default'],c:0,ex:'private restreint l\'accÃ¨s Ã  la classe uniquement.'},
  ],
  'mc-env':[
    {type:'mcq',pill:'â›ï¸ Minecraft Â· Setup',q:'Quel langage pour crÃ©er des mods Forge ?',opts:['Java','Python','C++','Lua'],c:0,ex:'Minecraft est en Java, donc les mods Forge aussi.'},
    {type:'mcq',pill:'â›ï¸ Minecraft Â· Setup',q:'Quel IDE est recommandÃ© pour les mods Minecraft ?',opts:['IntelliJ IDEA','Notepad','Visual Studio','Atom'],c:0,ex:'IntelliJ IDEA est l\'IDE le plus populaire pour Java/Minecraft.'},
    {type:'fill',pill:'â›ï¸ Minecraft Â· Setup',q:'Fichier de config principal d\'un mod Forge :',code:`src/main/resources/META-INF/<span class="op">___</span>.toml`,blank:'mods',ex:'mods.toml contient les mÃ©tadonnÃ©es du mod (nom, version, auteur...).'},
    {type:'mcq',pill:'â›ï¸ Forge vs Fabric',q:'Quelle diffÃ©rence Forge vs Fabric ?',opts:['Forge est complet, Fabric est lÃ©ger','Fabric est plus vieux','Ils sont identiques','Forge ne supporte que les blocs'],c:0,ex:'Forge a plus d\'APIs. Fabric est lÃ©ger et se met Ã  jour plus rapidement.'},
    {type:'mcq',pill:'â›ï¸ JDK',q:'Java requis pour Minecraft 1.20+ ?',opts:['Java 17','Java 8','Java 11','Java 21'],c:0,ex:'Minecraft 1.17+ requiert Java 17 LTS.'},
  ],
  'mc-item':[
    {type:'mcq',pill:'ğŸ’ Minecraft Â· Items',q:'Classe de base Ã  Ã©tendre pour un item Forge ?',opts:['Item','Block','Entity','Tile'],c:0,ex:'Tous les items hÃ©ritent de net.minecraft.world.item.Item.'},
    {type:'fill',pill:'ğŸ’ Minecraft Â· Items',q:'ComplÃ©tez pour hÃ©riter de la classe Item :',code:`<span class="kw">public class</span> <span class="cls">MonItem</span> <span class="kw">extends</span> <span class="op">___</span> { }`,blank:'Item',ex:'MonItem extends Item est la base de tout item custom Forge.'},
    {type:'mcq',pill:'ğŸ’ Minecraft Â· Items',q:'OÃ¹ placer le modÃ¨le JSON d\'un item ?',opts:['assets/modid/models/item/','src/items/','config/models/','data/modid/models/'],c:0,ex:'Les modÃ¨les JSON d\'items sont dans assets/[modid]/models/item/.'},
    {type:'mcq',pill:'ğŸ’ Minecraft Â· Items',q:'Comment rendre un item stackable Ã  64 ?',opts:['new Item.Properties().stacksTo(64)','item.setMaxStack(64)','Properties.stack = 64','@StackSize(64)'],c:0,ex:'Item.Properties().stacksTo(n) dÃ©finit la taille de pile maximale.'},
  ],
  'mc-rp':[
    {type:'mcq',pill:'ğŸ¨ Resource Packs',q:'RÃ©solution standard des textures Minecraft ?',opts:['16x16 px','64x64 px','256x256 px','128x128 px'],c:0,ex:'Le style vanilla utilise 16x16 pixels. Les HD packs vont jusqu\'Ã  512x512.'},
    {type:'mcq',pill:'ğŸ¨ Resource Packs',q:'Format d\'image pour un resource pack ?',opts:['PNG','JPG','BMP','GIF'],c:0,ex:'Minecraft utilise uniquement des PNG (support de la transparence alpha).'},
    {type:'fill',pill:'ğŸ¨ Resource Packs',q:'Fichier de config Ã  la racine du resource pack :',code:`<span class="op">___</span>.json`,blank:'pack',ex:'pack.json contient la description et le numÃ©ro de format du pack.'},
    {type:'mcq',pill:'ğŸ¨ Resource Packs',q:'Fichier listant les sons d\'un pack ?',opts:['sounds.json','audio.json','sound_list.json','config.json'],c:0,ex:'sounds.json dans assets/[namespace]/ dÃ©finit tous les sons et variantes.'},
  ],
  'mc-dp':[
    {type:'mcq',pill:'ğŸ“œ Datapacks',q:'Extension des fichiers de fonctions Minecraft ?',opts:['.mcfunction','.py','.java','.json'],c:0,ex:'Les fichiers .mcfunction contiennent des commandes, une par ligne.'},
    {type:'fill',pill:'ğŸ“œ Datapacks',q:'Donnez 1 diamant au joueur le plus proche :',code:`<span class="mc">give</span> @p <span class="op">___</span> 1`,blank:'diamond',ex:'give @p diamond 1 donne un diamant au joueur le plus proche.'},
    {type:'mcq',pill:'ğŸ“œ Datapacks',q:'Dossier des fonctions dans un datapack ?',opts:['data/[namespace]/functions/','src/functions/','scripts/','commands/'],c:0,ex:'Structure : data/[namespace]/functions/ma_fonction.mcfunction'},
    {type:'mcq',pill:'ğŸ“œ Datapacks',q:'Dossier des advancements ?',opts:['data/[namespace]/advancements/','assets/advancements/','achievements/','data/achievements/'],c:0,ex:'Les advancements JSON sont dans data/[namespace]/advancements/.'},
  ],
  'wo-lua':[
    {type:'mcq',pill:'ğŸ“œ Lua Â· Bases',q:'Comment dÃ©finir une variable locale en Lua ?',opts:['local x = 5','var x = 5','let x = 5','dim x = 5'],c:0,ex:'local x = 5 crÃ©e une variable locale. Sans local, elle est globale.'},
    {type:'mcq',pill:'ğŸ“œ Lua Â· Tables',q:'Qu\'est-ce qu\'une table Lua ?',opts:['Structure de donnÃ©es principale (dict + array)','Uniquement un tableau','Une base de donnÃ©es','Un fichier XML'],c:0,ex:'Les tables Lua sont polyvalentes : arrays, dicts, objets, modules.'},
    {type:'fill',pill:'ğŸ“œ Lua Â· Fonctions',q:'Mot-clÃ© pour dÃ©clarer une fonction Lua :',code:`<span class="op">___</span> direBonjour()\n  <span class="fn">print</span>(<span class="str">"Bonjour !"</span>)\n<span class="kw">end</span>`,blank:'function',ex:'Syntaxe : function nom(params) ... end'},
    {type:'mcq',pill:'ğŸ“œ Lua Â· Conditions',q:'Syntaxe if/else en Lua ?',opts:['if x > 0 then ... else ... end','if(x>0){...}','if x > 0: ...','if x > 0 do ...'],c:0,ex:'Lua utilise then et end pour dÃ©limiter les blocs conditionnels.'},
    {type:'mcq',pill:'ğŸ“œ Lua Â· Commentaires',q:'Comment commenter en Lua ?',opts:['-- commentaire','// commentaire','# commentaire','/* commentaire */'],c:0,ex:'-- commence un commentaire ligne. --[[ ... ]] pour multi-lignes.'},
  ],
  'wo-toc':[
    {type:'mcq',pill:'ğŸ“‹ WoW Â· TOC',q:'Fichier OBLIGATOIRE dans tout add-on WoW ?',opts:['MonAddon.toc','main.lua','config.xml','addon.json'],c:0,ex:'Le .toc (Table Of Contents) liste les fichiers et mÃ©tadonnÃ©es de l\'add-on.'},
    {type:'mcq',pill:'ğŸ“‹ WoW Â· TOC',q:'Ligne qui dÃ©finit la version WoW cible ?',opts:['## Interface: 100200','## Version: 1.0','## Patch: 10.2.0','## Build: 52649'],c:0,ex:'## Interface: 100200 = WoW 10.2.0. Le numÃ©ro est sans points.'},
    {type:'fill',pill:'ğŸ“‹ WoW Â· TOC',q:'PrÃ©fixe des mÃ©tadonnÃ©es dans un .toc :',code:`<span class="op">___</span> Title: Mon Add-on`,blank:'##',ex:'Toutes les mÃ©tadonnÃ©es commencent par ## (double diÃ¨se).'},
    {type:'mcq',pill:'ğŸ“‹ WoW Â· TOC',q:'Ordre de chargement des fichiers Lua du .toc ?',opts:['Dans l\'ordre listÃ©','AlphabÃ©tique','AlÃ©atoire','Par taille de fichier'],c:0,ex:'WoW charge les fichiers exactement dans l\'ordre du .toc.'},
  ],
  'wo-frame':[
    {type:'mcq',pill:'ğŸ–¼ï¸ WoW Â· Frames',q:'Fonction pour crÃ©er un frame WoW ?',opts:['CreateFrame("Frame", "MaFrame", UIParent)','new Frame()','WoW.Frame.create()','UICreateFrame("MaFrame")'],c:0,ex:'CreateFrame() est la fonction fondamentale pour crÃ©er des Ã©lÃ©ments UI.'},
    {type:'fill',pill:'ğŸ–¼ï¸ WoW Â· Frames',q:'MÃ©thode pour dÃ©finir la taille d\'un frame (200x100) :',code:`frame:<span class="op">___</span>(200, 100)`,blank:'SetSize',ex:'SetSize(largeur, hauteur) dÃ©finit les dimensions en pixels.'},
    {type:'mcq',pill:'ğŸ–¼ï¸ WoW Â· Frames',q:'Comment afficher un frame ?',opts:['frame:Show()','frame:visible = true','frame.SetVisible(true)','ShowFrame(frame)'],c:0,ex:'frame:Show() rend le frame visible. frame:Hide() le cache.'},
    {type:'mcq',pill:'ğŸ–¼ï¸ WoW Â· Frames',q:'MÃ©thode pour positionner un frame ?',opts:['frame:SetPoint("CENTER", UIParent, "CENTER", 0, 0)','frame.position = "center"','frame:MoveTo(x, y)','MoveFrame(frame, 0, 0)'],c:0,ex:'SetPoint() ancre le frame relativement Ã  un autre frame ou l\'Ã©cran.'},
  ],
  'lx-term':[
    {type:'mcq',pill:'ğŸ’» Linux Â· Terminal',q:'Lister les fichiers du rÃ©pertoire courant ?',opts:['ls','cd','pwd','dir'],c:0,ex:'ls (list) affiche fichiers et dossiers. ls -la pour les dÃ©tails.'},
    {type:'mcq',pill:'ğŸ’» Linux Â· Terminal',q:'Naviguer vers le dossier parent ?',opts:['cd ..','cd back','cd /home','cd up'],c:0,ex:'cd .. remonte d\'un niveau. cd ~ revient au rÃ©pertoire home.'},
    {type:'fill',pill:'ğŸ’» Linux Â· Terminal',q:'CrÃ©er un dossier "projet" :',code:`<span class="op">___</span> projet`,blank:'mkdir',ex:'mkdir (make directory) crÃ©e un nouveau rÃ©pertoire.'},
    {type:'mcq',pill:'ğŸ’» Linux Â· Terminal',q:'Afficher le contenu d\'un fichier texte.txt ?',opts:['cat texte.txt','open texte.txt','read texte.txt','type texte.txt'],c:0,ex:'cat affiche le contenu dans le terminal. less pour paginer.'},
    {type:'mcq',pill:'ğŸ’» Linux Â· Terminal',q:'Afficher le chemin absolu du rÃ©pertoire courant ?',opts:['pwd','ls -a','cd .','whereis'],c:0,ex:'pwd (print working directory) affiche votre position absolue.'},
  ],
  'lx-bash':[
    {type:'mcq',pill:'âš¡ Bash Â· Scripts',q:'PremiÃ¨re ligne obligatoire d\'un script Bash ?',opts:['#!/bin/bash','#bash','@bash','//bin/bash'],c:0,ex:'Le shebang #!/bin/bash indique l\'interprÃ©teur Ã  utiliser.'},
    {type:'fill',pill:'âš¡ Bash Â· Variables',q:'Commande pour afficher une variable :',code:`NOM="Alice"\n<span class="op">___</span> "Bonjour $NOM"`,blank:'echo',ex:'echo affiche du texte. Les variables $VAR sont interprÃ©tÃ©es dans les "".'},
    {type:'mcq',pill:'âš¡ Bash Â· Conditions',q:'Tester l\'existence d\'un fichier ?',opts:['if [ -f "fichier" ]','if file_exists("fichier")','if exist fichier','check -f fichier'],c:0,ex:'[ -f fichier ] teste un fichier rÃ©gulier. [ -d dossier ] pour un rÃ©pertoire.'},
    {type:'mcq',pill:'âš¡ Bash Â· Boucles',q:'ItÃ©rer sur tous les fichiers .txt ?',opts:['for f in *.txt; do','foreach f in *.txt','loop *.txt as f','for(*.txt)'],c:0,ex:'for f in *.txt; do ... done itÃ¨re sur tous les .txt du dossier courant.'},
  ],
  'daily':[
    {type:'mcq',pill:'âš¡ DÃ©fi du Jour',q:'En Python, diffÃ©rence entre = et == ?',opts:['= assigne, == compare','== assigne, = compare','Les deux comparent','Les deux assignent'],c:0,ex:'= est l\'assignation (x = 5). == est la comparaison (x == 5 â†’ True/False).'},
    {type:'mcq',pill:'âš¡ DÃ©fi du Jour',q:'En Java, annotation principale d\'un mod Forge ?',opts:['@Mod','@Plugin','@ForgeMod','@MinecraftMod'],c:0,ex:'@Mod("modid") dÃ©clare la classe principale comme un mod Forge.'},
    {type:'mcq',pill:'âš¡ DÃ©fi du Jour',q:'En Lua WoW, signe d\'un commentaire ?',opts:['--','//','#','/*'],c:0,ex:'-- commence un commentaire en Lua. --[[ ... ]] pour multi-lignes.'},
    {type:'mcq',pill:'âš¡ DÃ©fi du Jour',q:'Commande Ubuntu pour mettre Ã  jour tous les paquets ?',opts:['sudo apt upgrade','sudo apt update','sudo apt install','sudo apt refresh'],c:0,ex:'apt update â†’ rafraÃ®chit la liste. apt upgrade â†’ met Ã  jour les paquets.'},
    {type:'mcq',pill:'âš¡ DÃ©fi du Jour',q:'Dans un datapack Minecraft, @p dÃ©signe ?',opts:['Le joueur le plus proche','Tous les joueurs','Un joueur alÃ©atoire','Le joueur connectÃ©'],c:0,ex:'@p = joueur le plus proche. @a = tous. @r = alÃ©atoire. @s = soi-mÃªme.'},
  ],
};

const ACHIEVEMENTS = [
  {ico:'ğŸ”¥',nm:'7 jours de suite',ds:'SÃ©rie de 7 jours',cond:u=>u.streak>=7},
  {ico:'âš¡',nm:'1 000 XP',ds:'Atteignez 1000 XP',cond:u=>u.xp>=1000},
  {ico:'ğŸš€',nm:'5 000 XP',ds:'Atteignez 5000 XP',cond:u=>u.xp>=5000},
  {ico:'ğŸŒŸ',nm:'10 000 XP',ds:'Atteignez 10 000 XP',cond:u=>u.xp>=10000},
  {ico:'ğŸ',nm:'Pythoniste',ds:'Terminez Python Variables',cond:u=>(u.done||[]).includes('py-var')},
  {ico:'â›ï¸',nm:'Creeper Coder',ds:'Terminez Minecraft Setup',cond:u=>(u.done||[]).includes('mc-env')},
  {ico:'ğŸ§™',nm:'Warlock Dev',ds:'Terminez Lua WoW',cond:u=>(u.done||[]).includes('wo-lua')},
  {ico:'ğŸ’»',nm:'Terminal Pro',ds:'Terminez Linux Terminal',cond:u=>(u.done||[]).includes('lx-term')},
  {ico:'â˜•',nm:'Java Master',ds:'Terminez Java Bases',cond:u=>(u.done||[]).includes('jv-base')},
  {ico:'ğŸ¯',nm:'Perfect Run',ds:'100% sur une leÃ§on',cond:u=>(u.perfectRuns||0)>=1},
  {ico:'ğŸ“š',nm:'Curieux',ds:'Commencez 5 cours',cond:u=>Object.keys(u.progress||{}).length>=5},
  {ico:'â˜ï¸',nm:'Cloud Saver',ds:'ConnectÃ© via Firebase',cond:_=>true},
];

const MOCK_LB=[
  {name:'AlexCode',ava:'ğŸ‘¨â€ğŸ’»',xp:12450,streak:21,lvl:25},
  {name:'SarahDev',ava:'ğŸ‘©â€ğŸ’»',xp:10320,streak:14,lvl:21},
  {name:'MarcLinux',ava:'ğŸ§‘â€ğŸ’»',xp:9180,streak:8,lvl:19},
  {name:'PierreWoW',ava:'ğŸ§™',xp:7200,streak:5,lvl:15},
  {name:'LunaJava',ava:'ğŸ‘§',xp:5500,streak:3,lvl:12},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QUIZ STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let QS = { unit:null, course:null, qs:[], idx:0, correct:0, start:null, answered:false };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUTH UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initAuthUI(){
  // Particles
  const pc=document.getElementById('auth-particles');
  for(let i=0;i<25;i++){
    const d=document.createElement('div');
    d.className='particle';
    d.style.cssText=`left:${Math.random()*100}%;width:${1+Math.random()*3}px;height:${1+Math.random()*3}px;background:${Math.random()>.5?'#818cf8':'#5eead4'};opacity:${0.1+Math.random()*0.3};animation-duration:${5+Math.random()*8}s;animation-delay:${Math.random()*6}s;`;
    pc.appendChild(d);
  }
  // Avatar grid
  const ag=document.getElementById('ava-grid');
  ag.innerHTML=AVATARS.map((a,i)=>`<div class="ava-opt ${i===0?'sel':''}" onclick="selAvaFn(this,'${a}')">${a}</div>`).join('');
}

function selAvaFn(el,a){
  document.querySelectorAll('.ava-opt').forEach(e=>e.classList.remove('sel'));
  el.classList.add('sel'); selAva=a;
}
function switchTab(t){
  document.querySelectorAll('.auth-tab').forEach(e=>e.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('tab-login').style.display=t==='login'?'block':'none';
  document.getElementById('tab-register').style.display=t==='register'?'block':'none';
  clearMsg();
}
function showMsg(txt,type='error'){
  const m=document.getElementById('auth-msg');
  m.textContent=txt; m.className=`auth-msg show ${type}`;
}
function clearMsg(){ document.getElementById('auth-msg').classList.remove('show'); }

async function doLogin(){
  const email=document.getElementById('l-email').value.trim();
  const pwd=document.getElementById('l-pwd').value;
  clearMsg();
  if(!email||!pwd){showMsg('Veuillez remplir tous les champs.');return;}
  const btn=document.getElementById('login-btn');
  btn.disabled=true; btn.textContent='Connexionâ€¦';
  try{
    const {auth,signInWithEmailAndPassword}=window._fb;
    await signInWithEmailAndPassword(auth,email,pwd);
    // onAuthStateChanged prend le relais
  } catch(e){
    btn.disabled=false; btn.textContent='Se connecter â†’';
    const msgs={'auth/user-not-found':'Compte introuvable.','auth/wrong-password':'Mot de passe incorrect.','auth/invalid-email':'Email invalide.','auth/too-many-requests':'Trop de tentatives. RÃ©essayez plus tard.'};
    showMsg(msgs[e.code]||'Erreur de connexion. VÃ©rifiez vos identifiants.');
  }
}

async function doRegister(){
  const name=document.getElementById('r-name').value.trim();
  const email=document.getElementById('r-email').value.trim();
  const pwd=document.getElementById('r-pwd').value;
  clearMsg();
  if(!name||!email||!pwd){showMsg('Veuillez remplir tous les champs.');return;}
  if(pwd.length<6){showMsg('Mot de passe : minimum 6 caractÃ¨res.');return;}
  const btn=document.getElementById('register-btn');
  btn.disabled=true; btn.textContent='CrÃ©ationâ€¦';
  try{
    const {auth,db,createUserWithEmailAndPassword,doc,setDoc,serverTimestamp}=window._fb;
    const cred=await createUserWithEmailAndPassword(auth,email,pwd);
    const uid=cred.user.uid;
    const userData={
      uid, name, email, avatar:selAva,
      xp:0, level:1, xpPct:0, streak:1, lastDay:new Date().toDateString(),
      done:[], progress:{}, totalAnswered:0, totalCorrect:0, perfectRuns:0,
      createdAt:serverTimestamp()
    };
    await setDoc(doc(db,'users',uid),userData);
    window._currentUser={...userData};
    // onAuthStateChanged gÃ©rera la suite
  } catch(e){
    btn.disabled=false; btn.textContent='CrÃ©er mon compte ğŸš€';
    const msgs={'auth/email-already-in-use':'Cette adresse e-mail est dÃ©jÃ  utilisÃ©e.','auth/invalid-email':'Email invalide.','auth/weak-password':'Mot de passe trop faible.'};
    showMsg(msgs[e.code]||'Erreur lors de la crÃ©ation du compte.');
  }
}

async function doLogout(){
  const {auth,signOut}=window._fb;
  await signOut(auth);
  window._currentUser=null;
  showScreen('auth');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  APP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(name){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen-'+name).classList.add('active');
}

function enterApp(user){
  checkStreak(user);
  showScreen('app');
  refreshTopbar(user);
  renderCourses(user);
  renderLeaderboard(user);
  renderProfile(user);
  showView('home');
}

async function checkStreak(user){
  const today=new Date().toDateString();
  if(user.lastDay===today) return;
  const yesterday=new Date(Date.now()-86400000).toDateString();
  user.streak=user.lastDay===yesterday?(user.streak||0)+1:1;
  user.lastDay=today;
  window._currentUser=user;
  await saveUser(user);
}

async function saveUser(user){
  try{
    const {db,doc,updateDoc}=window._fb;
    const {uid,...data}=user;
    // Remove serverTimestamp field for updates
    delete data.createdAt;
    await updateDoc(doc(db,'users',user.uid),data);
    showToast('â˜ï¸ SauvegardÃ©','cloud');
  } catch(e){ console.warn('Save error:',e); }
}

function refreshTopbar(user){
  document.getElementById('hero-name').textContent=user.name;
  document.getElementById('tb-lvl').textContent=user.level||1;
  document.getElementById('tb-xp').textContent=(user.xp||0).toLocaleString('fr');
  document.getElementById('tb-str').textContent=user.streak||0;
  document.getElementById('tb-xp-fill').style.width=(user.xpPct||0)+'%';
  document.getElementById('sb-ava').textContent=user.avatar||'ğŸ§‘';
}

// â”€â”€â”€ COURSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getPct(user,cid){
  const c=COURSES.find(x=>x.id===cid); if(!c) return 0;
  const d=(user.done||[]).filter(id=>c.units.some(u=>u.id===id)).length;
  return Math.round((d/c.units.length)*100);
}

function renderCourses(user){
  document.getElementById('courses-grid').innerHTML=COURSES.map(c=>{
    const pct=getPct(user,c.id);
    const done=c.units.filter(u=>(user.done||[]).includes(u.id)).length;
    return `<div class="course-card" style="--cc:${c.color}" onclick="openCourse('${c.id}')">
      ${c.badge?`<div class="cc-badge">${c.badge}</div>`:''}
      <div class="cc-icon">${c.icon}</div>
      <div class="cc-name">${c.name}</div>
      <div class="cc-desc">${c.desc}</div>
      <div class="cc-prog"><div class="cc-prog-fill" style="width:${pct}%"></div></div>
      <div class="cc-meta"><span>${pct}% complÃ©tÃ©</span><span>${done}/${c.units.length}</span></div>
    </div>`;
  }).join('');
}

function openCourse(id){
  const user=window._currentUser;
  const c=COURSES.find(x=>x.id===id);
  QS.course=c;
  document.getElementById('lesson-title').textContent=`${c.icon} ${c.name}`;
  document.getElementById('lesson-sub').textContent=`${getPct(user,id)}% complÃ©tÃ© Â· ${c.units.length} leÃ§ons`;
  const done=user.done||[];
  document.getElementById('units-list').innerHTML=c.units.map((u,i)=>{
    const isDone=done.includes(u.id);
    const isLocked=u.locked&&!isDone&&!done.includes(c.units[i-1]?.id||'');
    return `<div class="unit-row ${isDone?'done':''} ${isLocked?'locked':''}" style="--uc:${c.color}"
      onclick="${!isLocked?`startLesson('${u.id}')`:`showToast('ğŸ”’ Terminez les leÃ§ons prÃ©cÃ©dentes !','err')`}">
      <div class="unit-ico">${isDone?'âœ…':u.icon}</div>
      <div class="unit-txt"><h3>${u.name}</h3><p>${u.desc}</p></div>
      <div class="unit-xp">+${u.xp} XP</div>
      <span>${isLocked?'ğŸ”’':isDone?'â­':'â–¶ï¸'}</span>
    </div>`;
  }).join('');
  showView('lesson');
}

// â”€â”€â”€ QUIZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startLesson(unitId){
  const raw=Q[unitId]||[
    {type:'mcq',pill:'ğŸ’¡ GÃ©nÃ©ral',q:'Qu\'est-ce qu\'une variable ?',opts:['Espace mÃ©moire nommÃ©','Un fichier','Un opÃ©rateur','Un type'],c:0,ex:'Une variable stocke une valeur en mÃ©moire sous un nom.'},
    {type:'mcq',pill:'ğŸ’¡ GÃ©nÃ©ral',q:'Qu\'est-ce qu\'une fonction ?',opts:['Bloc de code rÃ©utilisable','Un type','Un opÃ©rateur','Un fichier'],c:0,ex:'Une fonction est un bloc de code nommÃ© et rÃ©utilisable.'},
  ];
  // Shuffle
  QS.qs=[...raw].sort(()=>Math.random()-0.5);
  QS.unit=unitId; QS.idx=0; QS.correct=0; QS.answered=false; QS.start=Date.now();
  showView('quiz');
  loadQ();
}

function loadQ(){
  const q=QS.qs[QS.idx];
  const pct=Math.round((QS.idx/QS.qs.length)*100);
  document.getElementById('q-prog').style.width=pct+'%';
  document.getElementById('q-counter').textContent=`${QS.idx+1}/${QS.qs.length}`;
  document.getElementById('q-pill').textContent=q.pill||'Question';
  document.getElementById('q-text').textContent=q.q;
  document.getElementById('q-feedback').className='feedback';
  document.getElementById('skip-btn').style.display='';
  QS.answered=false;

  const code=document.getElementById('q-code');
  q.code?(code.style.display='block',code.innerHTML=q.code):(code.style.display='none');

  const wrap=document.getElementById('q-opts');
  const sb=document.getElementById('submit-btn');
  sb.textContent='VÃ©rifier'; sb.className='q-btn primary'; sb.disabled=true; sb.onclick=handleSubmit;

  if(q.type==='mcq'){
    const keys=['A','B','C','D'];
    wrap.innerHTML=`<div class="opts-grid">${q.opts.map((o,i)=>`
      <button class="opt-btn" onclick="selOpt(this,${i})" data-i="${i}">
        <span class="opt-key">${keys[i]}</span>${o}
      </button>`).join('')}</div>`;
  } else {
    wrap.innerHTML=`<div class="fill-wrap">
      <input class="fill-inp" id="fill-inp" placeholder="Votre rÃ©ponseâ€¦" autocomplete="off"
        oninput="document.getElementById('submit-btn').disabled=this.value.trim()===''">
    </div>`;
    setTimeout(()=>document.getElementById('fill-inp')?.focus(),50);
  }
}

function selOpt(btn,idx){
  if(QS.answered) return;
  document.querySelectorAll('.opt-btn').forEach(b=>b.classList.remove('sel'));
  btn.classList.add('sel');
  document.getElementById('submit-btn').disabled=false;
}

function handleSubmit(){
  if(QS.answered){nextQ();return;}
  QS.answered=true;
  const q=QS.qs[QS.idx];
  let ok=false;

  if(q.type==='mcq'){
    const sel=document.querySelector('.opt-btn.sel');
    const idx=parseInt(sel?.dataset.i??'-1');
    ok=idx===q.c;
    document.querySelectorAll('.opt-btn').forEach((b,i)=>{
      b.disabled=true;
      if(i===q.c) b.classList.add('ok');
      else if(i===idx&&!ok) b.classList.add('bad');
    });
  } else {
    const inp=document.getElementById('fill-inp');
    ok=inp?.value.trim().toLowerCase()===q.blank?.toLowerCase();
    if(inp){inp.disabled=true; inp.className='fill-inp '+(ok?'ok':'bad');}
  }

  if(ok){QS.correct++; showToast('+10 XP âš¡','xp');}

  const fb=document.getElementById('q-feedback');
  fb.className=`feedback show ${ok?'ok':'bad'}`;
  document.getElementById('fb-ico').textContent=ok?'âœ…':'âŒ';
  document.getElementById('fb-title').textContent=ok?'Excellent ! âœ“':'Pas tout Ã  faitâ€¦';
  document.getElementById('fb-detail').textContent=q.ex||'';

  const sb=document.getElementById('submit-btn');
  sb.textContent=QS.idx<QS.qs.length-1?'Continuer â†’':'Voir les rÃ©sultats';
  sb.className='q-btn success'; sb.disabled=false; sb.onclick=nextQ;
  document.getElementById('skip-btn').style.display='none';
}

function skipQ(){
  QS.idx++;
  if(QS.idx>=QS.qs.length){showResults();return;}
  loadQ();
}

function nextQ(){
  QS.idx++;
  if(QS.idx>=QS.qs.length){showResults();return;}
  loadQ();
}

async function showResults(){
  const user=window._currentUser;
  const elapsed=Math.floor((Date.now()-QS.start)/1000);
  const total=QS.qs.length;
  const acc=Math.round((QS.correct/total)*100);
  const xp=QS.correct*10*(QS.unit==='daily'?2:1);

  user.xp=(user.xp||0)+xp;
  user.totalAnswered=(user.totalAnswered||0)+total;
  user.totalCorrect=(user.totalCorrect||0)+QS.correct;
  if(acc===100) user.perfectRuns=(user.perfectRuns||0)+1;
  if(QS.unit&&QS.unit!=='daily'){
    user.done=user.done||[];
    if(!user.done.includes(QS.unit)) user.done.push(QS.unit);
  }
  const xpPerLvl=500;
  user.level=Math.floor(user.xp/xpPerLvl)+1;
  user.xpPct=((user.xp%xpPerLvl)/xpPerLvl)*100;
  window._currentUser=user;

  refreshTopbar(user);
  renderCourses(user);
  renderProfile(user);
  await saveUser(user);

  const mins=Math.floor(elapsed/60), secs=elapsed%60;
  const emoji=acc>=90?'ğŸ†':acc>=70?'ğŸ‰':acc>=50?'ğŸ‘':'ğŸ’ª';
  document.getElementById('res-trophy').textContent=emoji;
  document.getElementById('res-title').textContent=acc>=90?'Parfait !':acc>=70?'Excellent !':acc>=50?'Bien jouÃ© !':'Continue !';
  document.getElementById('res-sub').textContent=`${QS.correct}/${total} bonnes rÃ©ponses Â· ${xp} XP gagnÃ©s`;
  document.getElementById('rv-xp').textContent='+'+xp;
  document.getElementById('rv-acc').textContent=acc+'%';
  document.getElementById('rv-time').textContent=`${mins}:${secs.toString().padStart(2,'0')}`;
  showView('results');
}

function replayLesson(){startLesson(QS.unit);}
function exitQuiz(){
  document.getElementById('skip-btn').style.display='';
  QS.course?showView('lesson'):showView('home');
}

// â”€â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLeaderboard(user){
  user=user||window._currentUser;
  const all=[
    ...(user?[{name:user.name,ava:user.avatar||'ğŸ§‘',xp:user.xp||0,streak:user.streak||0,lvl:user.level||1,me:true}]:[]),
    ...MOCK_LB
  ].sort((a,b)=>b.xp-a.xp);
  const medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  document.getElementById('lb-list').innerHTML=all.map((p,i)=>`
    <div class="lb-row ${p.me?'me':''}">
      <div class="lb-rank">${medals[i]||i+1}</div>
      <div class="lb-ava" style="background:${p.me?'#5eead422':'#1a1d2e'}">${p.ava}</div>
      <div class="lb-info">
        <div class="lb-name">${p.name}${p.me?' <span style="color:var(--accent);font-size:0.7rem">â† Vous</span>':''}</div>
        <div class="lb-sub">Niveau ${p.lvl} Â· ğŸ”¥${p.streak} jours</div>
      </div>
      <div class="lb-xp">âš¡ ${(p.xp||0).toLocaleString('fr')}</div>
    </div>`).join('');
}

// â”€â”€â”€ PROFILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderProfile(user){
  user=user||window._currentUser; if(!user) return;
  document.getElementById('prof-ava').textContent=user.avatar||'ğŸ§‘';
  document.getElementById('prof-name').textContent=user.name;
  document.getElementById('prof-email').textContent=user.email;
  document.getElementById('ps-xp').textContent=(user.xp||0).toLocaleString('fr');
  document.getElementById('ps-str').textContent='ğŸ”¥'+(user.streak||0);
  document.getElementById('ps-les').textContent=(user.done||[]).length;
  const acc=user.totalAnswered?Math.round((user.totalCorrect/user.totalAnswered)*100):0;
  document.getElementById('ps-acc').textContent=acc+'%';
  document.getElementById('ach-grid').innerHTML=ACHIEVEMENTS.map(a=>{
    const un=a.cond(user);
    return `<div class="ach-card ${un?'unlocked':''}">
      <div class="ach-ico">${a.ico}</div>
      <div class="ach-nm">${a.nm}</div>
      <div class="ach-ds">${a.ds}</div>
      ${un?'<div style="margin-top:0.4rem;font-size:0.65rem;color:var(--accent4);font-weight:800;">âœ“ DÃ‰BLOQUÃ‰</div>':''}
    </div>`;
  }).join('');
}

// â”€â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showView(name){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('view-'+name)?.classList.add('active');
  document.getElementById('nb-'+name)?.classList.add('active');
  if(name==='leaderboard') renderLeaderboard();
  if(name==='profile') renderProfile();
}

// â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _tt;
function showToast(msg,cls='xp'){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className=`toast ${cls} show`;
  clearTimeout(_tt); _tt=setTimeout(()=>t.classList.remove('show'),2200);
}

// â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initAuthUI();
</script>
</body>
</html>
